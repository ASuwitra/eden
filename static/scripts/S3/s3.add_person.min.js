(function(){S3.addPersonWidget=function(b){var a="#"+b,e=$(a),m=e.next(".error_wrapper"),n=$(a+"_title__row"),k=$(a+"_full_name__row"),l=$(a+"_date_of_birth__row"),h=$(a+"_gender__row"),f=$(a+"_occupation__row"),c=$(a+"_email__row"),g=$(a+"_mobile_phone__row"),d=$(a+"_box_bottom");$(a+"__row").hide().after(d).after(g).after(c).after(f).after(h).after(l).after(k).after(n).after(m);n.show();k.show();l.show();h.show();f.show();c.show();g.show();d.show();e.val()?p(b):q(b);$("form").submit(function(){S3ClearNavigateAwayConfirm();
r(b);return!0})};var r=function(b){var a="#"+b;$(a+"_full_name").prop("disabled",!1);$(a+"_gender").prop("disabled",!1);$(a+"_date_of_birth").prop("disabled",!1);$(a+"_occupation").prop("disabled",!1);$(a+"_email").prop("disabled",!1);$(a+"_mobile_phone").prop("disabled",!1);$(a+"_edit_bar .icon-edit").hide();q(b)},p=function(b){var a="#"+b;$(a+"_full_name").prop("disabled",!0);$(a+"_gender").prop("disabled",!0);$(a+"_date_of_birth").prop("disabled",!0);$(a+"_occupation").prop("disabled",!0);$(a+
"_email").prop("disabled",!0);$(a+"_mobile_phone").prop("disabled",!0);$(a+"_edit_bar").removeClass("hide").show();$(a+"_edit_bar .icon-edit").click(function(){r(b)});$(a+"_edit_bar .icon-remove").click(function(){s(b)})},s=function(b){b="#"+b;$(b).val("");$(b+"_full_name").prop("disabled",!1).val("");$(b+"_gender").prop("disabled",!1).val("");$(b+"_date_of_birth").prop("disabled",!1).val("");$(b+"_occupation").prop("disabled",!1).val("");$(b+"_email").prop("disabled",!1).val("");$(b+"_mobile_phone").prop("disabled",
!1).val("");$(b+"_edit_bar").hide()},q=function(b){var a="#"+b,e=$(a+"_full_name");if(!e.attr("autocomplete")){var m=$(a),n=e.attr("data-c");$(a+"_full_name").after('<div id="'+b+'_throbber" class="throbber hide"></div>');var k=$(a+"_throbber"),l=S3.Ap.concat("/"+n+"/person/search_ac"),h=e.val(),f=!1;e.autocomplete({delay:450,minLength:2,source:function(a,b){$.ajax({url:l,data:{term:a.term}}).done(function(a){var c=0==a.length?i18n.no_matching_records:i18n.none_of_the_above;a.push({id:0,value:"",
label:c,first:c});b(a)})},search:function(a,b){e.hide();k.removeClass("hide").show();return!0},response:function(a,b,d){k.hide();e.show();return d},focus:function(a,b){var d=b.item,f=d.first;d.middle&&(f+=" "+d.middle);d.last&&(f+=" "+d.last);e.val(f);return!1},select:function(a,g){var d=g.item;if(d.id){var l=d.first;d.middle&&(l+=" "+d.middle);d.last&&(l+=" "+d.last);e.val(l);m.val(d.id);t(b,d.id)}else e.val(""),m.val("");f=!0;return!1}}).data("ui-autocomplete")._renderItem=function(a,b){var d=b.first;
b.middle&&(d+=" "+b.middle);b.last&&(d+=" "+b.last);return $("<li>").data("item.autocomplete",b).append("<a>"+d+"</a>").appendTo(a)};e.blur(function(){e.val()||(m.val(""),f=!0);f?h=e.val():e.val(h);f=!1})}},t=function(b,a){s(b);var e="#"+b,m=$(e),n=$(e+"_full_name"),k=n.attr("data-c"),k=S3.Ap.concat("/"+k+"/person/"+a+".s3json?show_ids=True");$.getJSONS3(k,function(a){try{var h=void 0,f=void 0,c=a.$_pr_person[0];p(b);m.val(c["@id"]);a=[];c.hasOwnProperty("first_name")&&a.push(c.first_name);c.hasOwnProperty("middle_name")&&
a.push(c.middle_name["@value"]);c.hasOwnProperty("last_name")&&a.push(c.last_name["@value"]);n.val(a.join(" "));c.hasOwnProperty("gender")&&$(e+"_gender").val(c.gender["@value"]);c.hasOwnProperty("date_of_birth")&&$(e+"_date_of_birth").val(c.date_of_birth["@value"]);c.hasOwnProperty("occupation")&&$(e+"_occupation").val(c.occupation["@value"]);if(c.hasOwnProperty("$_pr_email_contact"))var g=c.$_pr_email_contact[0],h=g.value["@value"];c.hasOwnProperty("$_pr_phone_contact")&&(g=c.$_pr_phone_contact[0],
f=g.value["@value"]);if(c.hasOwnProperty("$_pr_contact"))for(var d=c.$_pr_contact,c=0;c<d.length;c++)g=d[c],void 0==h&&"EMAIL"==g.contact_method["@value"]&&(h=g.value["@value"]),void 0==f&&"SMS"==g.contact_method["@value"]&&(f=g.value["@value"]);void 0!==h&&$(e+"_email").val(h);void 0!==f&&$(e+"_mobile_phone").val(f)}catch(k){m.val("")}})}})();
