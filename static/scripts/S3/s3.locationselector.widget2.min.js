var s3_gis_locationselector2=function(a,d,b,e,f,c,g){var k=$("#"+a+"__row .map_wrapper").attr("id",a+"_map_wrapper").hide(),h=$("#"+a+"_L0__row"),m=$("#"+a+"_L1__row"),p=$("#"+a+"_L2__row"),q=$("#"+a+"_L3__row"),r=$("#"+a+"_L4__row"),s=$("#"+a+"_L5__row");$("#"+a+"__row").hide().after(k).after(s).after(r).after(q).after(p).after(m).after(h);d&&lx_select(a,0,d);b&&lx_select(a,1,b);e&&lx_select(a,2,e);f&&lx_select(a,3,f);c&&lx_select(a,4,c);g&&lx_select(a,5,g);$("#"+a+"_L0").change(function(){lx_select(a,
0)});$("#"+a+"_L1").change(function(){lx_select(a,1)});$("#"+a+"_L2").change(function(){lx_select(a,2)});$("#"+a+"_L3").change(function(){lx_select(a,3)});$("#"+a+"_L4").change(function(){lx_select(a,4)});$("#"+a+"_L5").change(function(){lx_select(a,5)})};
function lx_select(a,d,b){$("#"+a+"_map_wrapper").hide();b||(b=$("#"+a+"_L"+d).val());if(b){$("#"+a).val(b);for(var e=d+1;6>e;e++)$("#"+a+"_L"+e+"__row").hide();d+=1;e=$("#"+a+"_L"+d+"__row");if(e.length){e.show();var f=!0,c;for(c in l)l[c].f==b&&(f=!1);f&&readHierarchy(a,d,b);f=[];for(c in l)v=l[c],v.l==d&&v.f==b&&(v.i=c,f.push(v));f.sort(nameSort);var g,k,h=$("#"+a+"_L"+d);$("#"+a+"_L"+d+" option").remove('[value != ""]');c=0;for(d=f.length;c<d;c++)g=f[c],e=g.i,k=b==e?' selected="selected"':"",
e='<option value="'+e+'"'+k+">"+g.n+"</option>",h.append(e)}else{$("#"+a+"_map_wrapper").show();if(!S3.gis.mapPanel){f=S3.gis.show_map();e=f.controls;c=0;for(d=e.length;c<d;c++)"OpenLayers.Control.DrawFeature"==e[c].CLASS_NAME&&(h=e[c]);h&&h.events.register("featureadded",null,function(b){b=b.feature.geometry.getBounds().getCenterLonLat();b.transform(S3.gis.projection_current,S3.gis.proj4326);$("#"+a+"_lat").val(b.lat);$("#"+a+"_lon").val(b.lon)})}c=l[b].b;c||(b=l[b].f,c=l[b].b,c||(b=l[b].f,c=l[b].b,
c||(c=l[l[b].f].b)));c&&(c=OpenLayers.Bounds.fromArray(c).transform(S3.gis.proj4326,S3.gis.projection_current),f.zoomToExtent(c))}}else{0===d?$("#"+a).val(""):(b=$("#"+a+"_L"+(d-1)).val(),$("#"+a).val(b));for(e=d+1;6>e;e++)$("#"+a+"_L"+e+"__row").hide()}}function nameSort(a,d){a=a.n;var b=[a,d.n];b.sort();return b[0]==a?-1:1}
function readHierarchy(a,d,b){$("#"+a+"_L"+d+"__throbber").show();b=S3.Ap.concat("/gis/ldata/"+b);$("#"+a+"_L"+(d+1)+"__row").length||(b+="/b");$.ajax({async:!1,url:b,success:function(b){for(var f in n)l[f]=n[f];n=null;$("#"+a+"_L"+d+"__throbber").hide()},error:function(a,b,c){msg="UNAUTHORIZED"==c?i18n.gis_requires_login:a.responseText},dataType:"script"})};
