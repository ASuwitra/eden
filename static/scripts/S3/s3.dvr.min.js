(function(){var f=function(){$(".alert-error, .alert-warning, .alert-info, .alert-success").fadeOut("fast");$(".error_wrapper").fadeOut("fast").remove()},h=function(d,e){var a=[".check-btn",".submit-btn"];e&&a.reverse();var c=$(d),b=c.find(a[0]);c.find(a[1]).prop("disabled",!0).hide().insertAfter(b);b.prop("disabled",!1).hide().removeClass("hide").show()},g=function(d,e){e||f();$("#case_event_label").val("");$("#case_event_person__row .controls").hide().empty();h(d,!1)};$(document).ready(function(){-1==
navigator.userAgent.toLowerCase().indexOf("android")?$(".zxing-button").addClass("disabled").unbind("click").click(function(a){a.preventDefault();a.stopPropagation();return!1}):$(".zxing-button").unbind(".dvr").bind("click.dvr",function(){f()});$(".event-type-toggle").unbind(".dvr").bind("click.dvr",function(){var a=$("ul.event-type-selector");a.hasClass("hide")?a.hide().removeClass("hide").slideDown():a.slideToggle()});$("a.event-type-selector").unbind(".dvr").bind("click.dvr",function(){var a=$(this),
c=a.data("code"),b=a.data("name");$('input[type="hidden"][name="event"]').val(c);$(".event-type-name").text(b);$("#case_event_person__row .controls").text()&&h($("form"),!0);$(".zxing-button").each(function(){var a=$(this),b=a.data("tmp");b&&a.attr("href",b.replace("%7BEVENT%7D",c))});a.closest("ul.event-type-selector").slideUp()});var d=$("#case_event_label").unbind(".dvr");d.focus().val(d.val());d.bind("input.dvr",function(a){f();$("#case_event_person__row .controls").hide().empty();h($(this).closest("form"),
!1)});d.bind("keyup.dvr",function(a){switch(a.which){case 27:g($(this).closest("form"))}});$("a.cancel-action").unbind(".dvr").bind("click.dvr",function(a){a.preventDefault();g($(this).closest("form"))});var e=$("#case_event_person__row .controls");$(".check-btn").unbind(".dvr").bind("click.dvr",function(a){a.preventDefault();f();if(a=$("#case_event_label").val()){a={l:a,c:!0};var c=S3.Ap.concat("/dvr/case_event/register.json");e.empty();var b=$('<div class="inline-throbber">').insertAfter(e);$.ajaxS3({url:c,
type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify(a),success:function(a){b.remove();a.e?$('<div class="error_wrapper"><div id="label__error" class="error" style="display: block;">'+a.e+"</div></div>").hide().insertAfter($("#case_event_label")).slideDown():(e.html(a.p).removeClass("hide").show(),$('input[type="hidden"][name="event"]').val()&&h($("form"),!0));a.a?S3.showAlert(a.a,"error"):a.m&&S3.showAlert(a.m,"success")},error:function(){b.remove();g($("form"),
!0)}})}});$(".submit-btn").unbind(".dvr").bind("click.dvr",function(a){a.preventDefault();f();a=$("#case_event_label").val();var c=$('input[type="hidden"][name="event"]').val();if(a&&c){a={l:a,t:c};var c=S3.Ap.concat("/dvr/case_event/register.json"),b=$('<div class="inline-throbber">').insertAfter(e);$.ajaxS3({url:c,type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify(a),success:function(a){b.remove();a.e?$('<div class="error_wrapper"><div id="label__error" class="error" style="display: block;">'+
a.e+"</div></div>").hide().insertAfter($("#case_event_label")).slideDown():g($("form"));a.a?S3.showAlert(a.a,"error",!1):a.m&&S3.showAlert(a.m,"success",!1)},error:function(){b.remove();g($("form"),!0)}})}})})})(jQuery);
