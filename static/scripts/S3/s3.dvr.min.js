(function(){var h=function(){$(".alert-error, .alert-warning, .alert-info, .alert-success").fadeOut("fast");$(".error_wrapper").fadeOut("fast").remove()},k=function(b,c){var d=$(b),e=[".check-btn",".submit-btn"];if(c){var a=d.find("input[type=hidden][name=permitted]"),f=!1;a.length&&(a=a.val())&&(f=JSON.parse(a));f&&e.reverse()}a=d.find(e[0]);d.find(e[1]).prop("disabled",!0).hide().insertAfter(a);a.prop("disabled",!1).hide().removeClass("hide").show()},g=function(b,c,d){c||h();c=$(b);c.find("input[type=hidden][name=permitted]").val("false");
c.find("input[type=hidden][name=flags]").val("[]");d||$("#case_event_label").val("");$("#case_event_person__row .controls").hide().empty();$("#case_event_flaginfo__row .controls").empty();k(b,!1)},l=function(b){b=$(b).find("input[type=hidden][name=flags]");var c=$("#case_event_flaginfo__row .controls").empty();b=b.length?JSON.parse(b.val()):[];var d=b.length;if(d){c.addClass("has-flaginfo");for(var c=$('<div class="checkpoint-advise">').hide().appendTo(c),e,a,f=0;f<d;f++)e=b[f],a=$('<div class="checkpoint-instructions">').appendTo(c),
$("<h4>"+e.n+"</h4>").appendTo(a),e.i&&$("<p>"+e.i+"</p>").appendTo(a);c.slideDown()}};$(document).ready(function(){-1==navigator.userAgent.toLowerCase().indexOf("android")?$(".zxing-button").addClass("disabled").unbind("click").click(function(a){a.preventDefault();a.stopPropagation();return!1}):$(".zxing-button").unbind(".dvr").bind("click.dvr",function(){h()});$(".event-type-toggle").unbind(".dvr").bind("click.dvr",function(){var a=$("ul.event-type-selector");a.hasClass("hide")?a.hide().removeClass("hide").slideDown():
a.slideToggle()});$("a.event-type-selector").unbind(".dvr").bind("click.dvr",function(){var a=$(this),b=a.data("code"),c=a.data("name");$('input[type="hidden"][name="event"]').val(b);$(".event-type-name").text(c);$("#case_event_person__row .controls").text()&&k($("form"),!0);$(".zxing-button").each(function(){var a=$(this),c=a.data("tmp");c&&a.attr("href",c.replace("%7BEVENT%7D",b))});a.closest("ul.event-type-selector").slideUp()});var b=$("#case_event_label").unbind(".dvr");b.focus().val(b.val());
b.bind("input.dvr",function(a){g($(this).closest("form"),!1,!0)});b.bind("keyup.dvr",function(a){switch(a.which){case 27:g($(this).closest("form"))}});$("a.cancel-action").unbind(".dvr").bind("click.dvr",function(a){a.preventDefault();g($(this).closest("form"))});var c=$("#case_event_person__row .controls"),d=$("form input[type=hidden][name=flags]"),e=$("form input[type=hidden][name=permitted]");$(".check-btn").unbind(".dvr").bind("click.dvr",function(a){a.preventDefault();h();if(a=$("#case_event_label").val()){a=
{l:a,c:!0};var b=S3.Ap.concat("/dvr/case_event/register.json");c.empty();var m=$('<div class="inline-throbber">').insertAfter(c);$.ajaxS3({url:b,type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify(a),success:function(a){m.remove();a.e?$('<div class="error_wrapper"><div id="label__error" class="error" style="display: block;">'+a.e+"</div></div>").hide().insertAfter($("#case_event_label")).slideDown():(c.html(a.p).removeClass("hide").show(),a.f?d.val(JSON.stringify(a.f)):
d.val("[]"),void 0!==a.s?e.val(JSON.stringify(a.s)):e.val("false"),$('input[type="hidden"][name="event"]').val()&&k($("form"),!0),l($("form")));a.a?S3.showAlert(a.a,"error"):a.m&&S3.showAlert(a.m,"success")},error:function(){m.remove();g($("form"),!0)}})}});$(".submit-btn").unbind(".dvr").bind("click.dvr",function(a){a.preventDefault();h();a=$("#case_event_label").val();var b=$('input[type="hidden"][name="event"]').val();if(a&&b){a={l:a,t:b};var b=S3.Ap.concat("/dvr/case_event/register.json"),d=$('<div class="inline-throbber">').insertAfter(c);
$.ajaxS3({url:b,type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify(a),success:function(a){d.remove();a.e?$('<div class="error_wrapper"><div id="label__error" class="error" style="display: block;">'+a.e+"</div></div>").hide().insertAfter($("#case_event_label")).slideDown():g($("form"));a.a?S3.showAlert(a.a,"error",!1):a.m&&S3.showAlert(a.m,"success",!1)},error:function(){d.remove();g($("form"),!0)}})}});l($("form"))})})(jQuery);
