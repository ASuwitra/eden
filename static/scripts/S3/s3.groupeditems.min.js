/*
 2015 (c) Sahana Software Foundation
 @license MIT

 requires jQuery 1.9.1+
 requires jQuery UI 1.10 widget factory
*/
(function(e,q){var p=0;e.widget("s3.groupedItems",{options:{renderGroupHeaders:!1,totalsLabel:"TOTAL"},_create:function(){e(this.element);this.id=p;p+=1},_init:function(){this.items=e(this.element).find(".gi-data").first();this.refresh()},_destroy:function(){e.Widget.prototype.destroy.call(this)},refresh:function(){var a=e(this.element);a.find(".gi-throbber").hide();this._unbindEvents();this.data||this._deserialize();var b=this.data,d=a.find(".gi-table");b.e?(d.hide(),d.empty(),a.find(".gi-empty").show()):
(a.find(".gi-empty").hide(),d.empty(),b=this._renderTable(b),d.append(b).show());this._bindEvents();a.find(".gi-throbber").hide()},_renderTable:function(a){var b=e('<table class="groupeditems">');this._renderTableHeader(a).appendTo(b);this._renderGroup(b,a);this._renderTableFooter(a).appendTo(b);return b},_renderTableHeader:function(a){var b=e("<thead>"),d=e('<tr class="gi-column-headers">').appendTo(b),c=a.c;a=a.l;for(var k,g=0,f=c.length;g<f;g++)k=a[c[g]],e("<th>").html(k).appendTo(d);return b},
_renderTableFooter:function(a){var b=this.options,d=e("<tfoot>"),c=e('<tr class="gi-column-totals">'),k=a.t,g=!1,f;for(f in k){g=!0;break}if(g){a=a.c;for(var h=null,m=0,l=0,n=a.length;l<n;l++){if(!h){if(!k.hasOwnProperty(a[l])){m++;continue}1<m&&(h=e('<td class="gi-group-footer-label" colspan="'+m+'">'),e("<span> "+b.totalsLabel+"</span>").appendTo(h),h.appendTo(c))}f=e("<td>").appendTo(c);(g=k[a[l]])&&f.html(g)}c.appendTo(d)}return d},_renderGroup:function(a,b,d,c){"undefined"==typeof d&&(d=b);"undefined"==
typeof c&&(c=0);this.options.renderGroupHeaders&&0<c&&this._renderGroupHeader(a,b,d,c);var e=d.d,g=d.i,f,h;if(e)for(f=0,h=e.length;f<h;f++)this._renderGroup(a,b,e[f],c+1);else if(g)for(f=0,h=g.length;f<h;f++)this._renderItem(a,b,g[f],c);0<c&&this._renderGroupFooter(a,b,d,c)},_renderGroupHeader:function(a,b,d,c){b=b.c;d=d.v;c=e('<tr class="gi-group-header gi-level-'+c+'">');e('<td colspan="'+b.length+'">').html(d).appendTo(c);c.appendTo(a)},_renderGroupFooter:function(a,b,d,c){var k=this.options,g=
d.t,f=!1,h;for(h in g){f=!0;break}b=b.c;d=d.v;c=e('<tr class="gi-group-footer gi-level-'+c+'">');if(!f&&!k.renderGroupHeaders)e('<td colspan="'+b.length+'">').html(d).appendTo(c),c.appendTo(a);else if(f){f=0;h=null;for(var m,l,n=0,p=b.length;n<p;n++){if(!h){if(!g.hasOwnProperty(b[n])){f++;continue}1<f&&(h=e('<td class="gi-group-footer-label" colspan="'+f+'">').html(d),e("<span> "+k.totalsLabel+"</span>").appendTo(h),h.appendTo(c))}l=e("<td>").appendTo(c);(m=g[b[n]])&&l.html(m)}c.appendTo(a)}},_renderItem:function(a,
b,d,c){c=e('<tr class="gi-item gi-level-'+c+'">');b=b.c;for(var k,g,f=0,h=b.length;f<h;f++)g=e("<td>"),(k=d[b[f]])&&g.html(k),g.appendTo(c);c.appendTo(a)},_serialize:function(){var a=this.items;if(a){var b="";this.data&&(b=JSON.stringify(this.data));a.val(b)}return b},_deserialize:function(){this.data={};var a=this.items;a&&(a=a.val())&&(this.data=JSON.parse(a));return this.data},_bindEvents:function(){return!0},_unbindEvents:function(){return!0}})})(jQuery);
