/*
 2015 (c) Sahana Software Foundation
 @license MIT

 requires jQuery 1.9.1+
 requires jQuery UI 1.10 widget factory
*/
(function(e,p){var l=0;e.widget("s3.groupedItems",{options:{renderGroupHeaders:!1},_create:function(){e(this.element);this.id=l;l+=1},_init:function(){this.items=e(this.element).find(".gi-data").first();this.refresh()},_destroy:function(){e.Widget.prototype.destroy.call(this)},refresh:function(){var b=e(this.element);b.find(".gi-throbber").hide();this._unbindEvents();this.data||this._deserialize();var a=this.data,d=b.find(".gi-table");a.e?(d.hide(),d.empty(),b.find(".gi-empty").show()):(b.find(".gi-empty").hide(),
d.empty(),a=this._renderTable(a),d.append(a).show());this._bindEvents();b.find(".gi-throbber").hide()},_renderTable:function(b){var a=e('<table class="groupeditems">');this._renderTableHeader(b).appendTo(a);this._renderGroup(a,b);this._renderTableFooter(b).appendTo(a);return a},_renderTableHeader:function(b){var a=e("<thead>"),d=e('<tr class="gi-column-headers">').appendTo(a),c=b.c;b=b.l;for(var h,g=0,f=c.length;g<f;g++)h=b[c[g]],e("<th>").html(h).appendTo(d);return a},_renderTableFooter:function(b){var a=
e("<tfoot>"),d=e('<tr class="gi-column-totals">'),c=b.t,h=!1,g;for(g in c){h=!0;break}if(h){b=b.c;for(var f=0,k=b.length;f<k;f++)g=e("<td>").appendTo(d),(h=c[b[f]])&&g.html(h);d.appendTo(a)}return a},_renderGroup:function(b,a,d,c){"undefined"==typeof d&&(d=a);"undefined"==typeof c&&(c=0);this.options.renderGroupHeaders&&0<c&&this._renderGroupHeader(b,a,d,c);var e=d.d,g=d.i,f,k;if(e)for(f=0,k=e.length;f<k;f++)this._renderGroup(b,a,e[f],c+1);else if(g)for(f=0,k=g.length;f<k;f++)this._renderItem(b,a,
g[f],c);0<c&&this._renderGroupFooter(b,a,d,c)},_renderGroupHeader:function(b,a,d,c){a=a.c;d=d.v;c=e('<tr class="gi-group-header gi-level-'+c+'">');e('<td colspan="'+a.length+'">').html(d).appendTo(c);c.appendTo(b)},_renderGroupFooter:function(b,a,d,c){var h=d.t,g=!1,f;for(f in h){g=!0;break}a=a.c;d=d.v;c=e('<tr class="gi-group-footer gi-level-'+c+'">');if(!g&&!opts.renderGroupHeaders)e('<td colspan="'+a.length+'">').html(d).appendTo(c),c.appendTo(b);else if(g){g=0;f=null;for(var k,l,m=0,n=a.length;m<
n;m++){if(!f){if(!h.hasOwnProperty(a[m])){g++;continue}1<g&&(f=e('<td class="gi-group-footer-label" colspan="'+g+'">').html(d),e("<span> TOTAL</span>").appendTo(f),f.appendTo(c))}l=e("<td>").appendTo(c);(k=h[a[m]])&&l.html(k)}c.appendTo(b)}},_renderItem:function(b,a,d,c){c=e('<tr class="gi-item gi-level-'+c+'">');a=a.c;for(var h,g,f=0,k=a.length;f<k;f++)g=e("<td>"),(h=d[a[f]])&&g.html(h),g.appendTo(c);c.appendTo(b)},_serialize:function(){var b=this.items;if(b){var a="";this.data&&(a=JSON.stringify(this.data));
b.val(a)}return a},_deserialize:function(){this.data={};var b=this.items;b&&(b=b.val())&&(this.data=JSON.parse(b));return this.data},_bindEvents:function(){return!0},_unbindEvents:function(){return!0}})})(jQuery);
